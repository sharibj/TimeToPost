<!DOCTYPE html>
<html>

<head>
    <title>Token Flow</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css" rel="stylesheet">
    <!-- peer dependency -->
    <script src="https://unpkg.com/react@16.3.1/umd/react.development.js"></script>
    <!-- lib (change x.x.x for the version you would like) -->
    <script src="https://unpkg.com/react-beautiful-dnd@x.x.x/dist/react-beautiful-dnd.js"></script>
    <!-- needed to mount your react app -->
    <script src="https://unpkg.com/react-dom@16.3.1/umd/react-dom.development.js"></script>
</head>

<body class="flex justify-center items-center h-screen">
    <div class="grid grid-flow-row grid-rows-2 grid-cols-1 gap-4">

        <div class="grid grid-flow-row grid-rows-1 grid-cols-1 gap-4 invisible" id="spinner">
            <div aria-label="Loading..." role="status" class="flex justify-center items-center ">
                <svg class="animate-spin w-10 h-10" viewBox="3 3 18 18">
                    <path class="opacity-20"
                        d="M12 5C8.13401 5 5 8.13401 5 12C5 15.866 8.13401 19 12 19C15.866 19 19 15.866 19 12C19 8.13401 15.866 5 12 5ZM3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12Z">
                    </path>
                    <path
                        d="M16.9497 7.05015C14.2161 4.31648 9.78392 4.31648 7.05025 7.05015C6.65973 7.44067 6.02656 7.44067 5.63604 7.05015C5.24551 6.65962 5.24551 6.02646 5.63604 5.63593C9.15076 2.12121 14.8492 2.12121 18.364 5.63593C18.7545 6.02646 18.7545 6.65962 18.364 7.05015C17.9734 7.44067 17.3403 7.44067 16.9497 7.05015Z">
                    </path>
                </svg>
            </div>
        </div>
        <div class="grid grid-flow-row grid-rows-1 grid-cols-2 gap-4">
            <input type="file" id="fileInput">
            <button
                class="hover:text-white hover:bg-black px-6 h-12 uppercase font-semibold tracking-wider border-2 border-black bg-teal-400 text-black"
                onclick="uploadPoolFile()">Upload Pool File</button>
            <button
                class="hover:text-white hover:bg-black px-6 h-12 uppercase font-semibold tracking-wider border-2 border-black bg-teal-400 text-black"
                onclick="downloadPoolFile()">Download Pool File</button>
        </div>
        <div class="grid grid-flow-row grid-rows-1 grid-cols-1 gap-4">

            <button
                class="hover:text-white hover:bg-black px-6 h-12 uppercase font-semibold tracking-wider border-2 border-black bg-teal-400 text-black"
                onclick="initiateLinkedInAccess()">Allow LinkedIn Access</button>
        </div>
    </div>

    <script>
        const React = window.React;
        const ReactDOM = window.ReactDOM;
        const { DragDropContext, Draggable, Droppable } = window.ReactBeautifulDnd;

        function App() {
            // ...
        }

        // You can use JSX if your environment supports it
        ReactDOM.render(React.createElement(App), document.getElementById('app'));
        function uploadPoolFile() {
            // Add your upload pool file logic here
            console.log("Uploading pool file...");
            let currentUrl = window.location.href;
            // Remove any query parameters from the current URL
            const urlWithoutParams = currentUrl.split("?")[0];
            // Append '/upload' to the current URL
            const url = `${urlWithoutParams}/upload`;
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];

            if (file) {
                if (file.type === "text/plain") {
                    const xhr = new XMLHttpRequest();
                    xhr.open('GET', url, true);
                    xhr.onreadystatechange = function () {
                        if (xhr.readyState === 4) {
                            if (xhr.status === 200) {
                                const response = JSON.parse(xhr.responseText);
                                const uploadURL = response.uploadURL;
                                uploadFileToS3(uploadURL, file);
                            } else {
                                console.error('Error getting upload URL:', xhr.status);
                            }
                        }
                    };
                    xhr.send();
                } else {
                    console.error('Please upload a valid text file.');
                }
            } else {
                console.error('No file selected.');
            }
        }

        function uploadFileToS3(uploadURL, file) {
            const xhr = new XMLHttpRequest();
            xhr.open('PUT', uploadURL, true);
            xhr.setRequestHeader('Content-Type', file.type);
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        console.log('File uploaded successfully');
                    } else {
                        console.error('Error uploading file:', xhr.status);
                    }
                }
            };
            xhr.send(file);
        }

        function downloadPoolFile() {
            // Add your upload pool file logic here
            console.log("Uploading pool file...");
            let currentUrl = window.location.href;
            // Remove any query parameters from the current URL
            const urlWithoutParams = currentUrl.split("?")[0];
            // Append '/upload' to the current URL
            const url = `${urlWithoutParams}/download`;
            const xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        const response = JSON.parse(xhr.responseText);
                        const s3_url = response.downloadURL;
                        console.log(s3_url)
                        window.open(s3_url, '_blank');
                    } else {
                        console.error('Error getting download URL:', xhr.status);
                    }
                }
            };
            xhr.send();
        }

        function initiateLinkedInAccess() {
            // Add your LinkedIn access token flow using code grant here
            console.log("Initiating LinkedIn access token flow...");
            showSpinner();
            let currentUrl = window.location.href;

            // Remove any query parameters from the current URL
            const urlWithoutParams = currentUrl.split("?")[0];

            // Append '/authorize' to the current URL
            const redirectWithAuthorize = `${urlWithoutParams}/authorize`;

            // Redirect the user to the modified URL
            window.location.href = redirectWithAuthorize;
        }

        function showSpinner() {
            var spinnerElement = document.getElementById("spinner");
            spinnerElement.classList.remove("invisible");
        }
    </script>
</body>

</html>